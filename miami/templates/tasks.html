{% extends "layout.html" %}
{% block body %}
<a href="#myModal" role="button" class="btn btn-small" data-toggle="modal"> <i class="icon-plus"></i>
</a>

<!-- NEW Task Form -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">New Task</h3>
  </div>
  <div class="modal-body">
    <input id="title" type="text" class="input-block-level" placeholder="title">
    <textarea id = "detail"class="input-block-level" rows="10" placeholder="detail"></textarea>
  </div>
  <div class="modal-footer">
    <button id="save" class="btn btn-primary">Save</button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<table class="table .table-striped">
  <thead>
    <tr>
      <td>Id</td>
      <td>Status</td>
      <td>Title</td>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
<script type="text/javascript">
    (function() {
    "use strict";
    $(document).ready(function() {

      $('li').removeClass('active');
      $("ul li:nth-child(2)").addClass('active');

      reloadTasks();
      
      $('#save').click(function(){
        $.ajax({
          type: 'POST',
          url: '/api/task',
          data: '{"title":"'+$('#title').val()+'","detail":"'+$('#detail').val()+'"}',
          success: function(data){
            $('#myModal').modal('hide');
            reloadTasks();
          },
          dataType: 'json',
          contentType: 'application/json'
        });
      });
    });

    function reloadTasks(){
      $.ajax({
        type: 'GET',
        url: '/api/task',
        success: function(data){
          $('tbody > tr').remove();
          for(var i in data.objects) {
            $('.table > tbody').append('<tr><td>' + data.objects[i].id + '</td><td>' + data.objects[i].status + '</td><td>' + data.objects[i].title+ '</td></tr>');
          }
        },
        dataType: 'json'
      });
    }
  }());
</script>
{% endblock %}